import socket
import os

# Server address and port
server_address = ("127.0.0.1", 8080)


def main():
    # Create a TCP/IP socket
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    try:
        # Connect to the server
        s.connect(server_address)
        # Construct a normal request: Content-Length == length(POST_BODY)
        print("[*] Sending and receive normal request...")
        post_request = (
            "POST /vulnerable.jsp HTTP/1.1\r\n"
            "Host: localhost\r\n"
            "Connection: keep-alive\r\n"
            "Content-Type: application/x-www-form-urlencoded\r\n"
            "Content-Length: 1488\r\n"
            "\r\n"
            "id=123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789"
        )
        # normal_body = "id=123456789123456789123456789123456789123456789"
        # send request
        s.sendall(post_request.encode("utf-8"))
        # receive response
        response = []
        while True:
            data = s.recv(1024)
            if not data:
                break
            response.append(data)

        data = b"".join(response).decode("utf-8")
        # s.recv(2048)

        # print(f"[*] Received normal response:\n{response.decode('utf-8')}")
        print(f"[*] Received normal response:\n{data}")
        # Maintain socket connection
        # import attacker

        # attacker.main()

        input("[*] Press Enter to close socket connection...")

    except Exception as e:
        print(f"An error occurred: {e}")

    finally:
        # Ensure that the socket is closed
        s.close()


if __name__ == "__main__":
    main()
